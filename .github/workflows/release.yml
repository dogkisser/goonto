name: build

on:
  release:
    types: [published]


jobs:
  build:
    name: Build

    timeout-minutes: 10
    strategy:
      matrix:
        os: [ubuntu, windows]

    permissions:
      contents: write

    runs-on: ${{ matrix.os }}-latest
    steps:
      - uses: actions/checkout@v4
      - uses: dtolnay/rust-toolchain@stable

      - name: install deps
        run: >
          sudo apt-get update && sudo apt-get install --no-install-recommends -y
          cmake
          libx11-dev libxext-dev libxft-dev libxinerama-dev libxcursor-dev libxrender-dev
          libxfixes-dev libpango1.0-dev libgl1-mesa-dev libglu1-mesa-dev libxdo-dev
        if: ${{ matrix.os != 'windows' }}
      
      - name: build release
        run: cargo build --release

      - name: add artifact
        uses: softprops/action-gh-release@v1
        with:
          files: target/release/goonto*(.exe)